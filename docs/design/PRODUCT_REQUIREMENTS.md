# Attenda - 产品功能文档

版本：1.0

概述

Attenda 是一个基于 Sui 区块链、Walrus 存储与 Seal 加密的去中心化活动与票务平台。目标是为活动组织者与参与者提供私密、安全、可验证且可组合的票务与出席体验。

目标用户

- 活动组织者（主办方 / 赞助商）
- 参与者（使用钱包或 ZkLogin 登录的用户）
- 第三方集成方（支付网关、邮件服务、赞助方）

核心价值主张

- 私密与可验证：加密门票与链上证明结合，保护用户隐私同时保证事件的可验证性。
- 用户拥有权：门票以 NFT 形式存在，用户真实拥有并可展示或转移（依据规则）。
- 可组合出席数据：出席记录可用于空投、忠诚计划或其他激励。

---

功能清单（按优先级）

## 一、核心功能（MVP）

1. 活动管理（组织者）
   - 创建活动：填写活动标题、时间、地点、封面图片、描述、标签、容量等。
   - 上传活动内容：将富媒体（议程、演讲人简介、海报）上传到 Walrus Site。
   - 设置票种：创建不同票种（价格、数量、可见性、是否可转让、是否审批）。
   - 发布/下线活动：切换活动状态（active/paused/closed/cancelled）。
   - 查看统计：实时查看报名/售票/出席统计（基础版）。

2. 报名与支付（参与者）
   - 支持 ZkLogin 或钱包登录。
   - 选择票种并完成购买（支持 Sui 钱包支付与第三方支付回调）。
   - 支持折扣码输入与校验。
   - 购买成功后前端显示确认并将门票以 NFT 形式铸造到用户钱包（链上）。
   - 支持下载/发送 ICS 日历邀请。

3. NFT 门票与私密元数据
   - 门票以 NFT 铸造在 Sui，NFT metadata 包含对 Walrus 加密 blob 的引用。
   - 使用 Seal 对门票的敏感元数据（位置、二维码、访问链接、座位信息）进行加密并上传 Walrus。
   - 只有合法持票人通过密钥交换或 ZK 验证后可解密查看。

4. 入场验证与出席记录
   - 支持二维码扫描与钱包验证的入场流程。
   - 扫描验证成功后生成出席记录并触发铸造 Attendance NFT（可选 soulbound）。
   - 出席记录上链以作为后续奖励/信誉的依据。

5. 数据与隐私控制
   - 组织者可以导出匿名化出席数据。
   - 用户可以删除或撤销对 Walrus 上加密 blob 的访问，链上证明保持不变。

## 二、扩展功能（后续版本）

1. 折扣与审批
   - 创建折扣码（百分比/固定金额）并管理有效期与使用次数。
   - 活动报名审批流程（手动/自动规则）。

2. 通知与通信
   - 邮件、钱包通知、应用内消息（提醒、更新、确认）。
   - 活动聊天/公告面板（Walrus Site 集成）。

3. 高级统计与导出
   - 导出 CSV、报表仪表盘（收入、转化率、出席率）。
   - 分时统计、地域分布。（基于匿名化数据）

4. 多会场与票种高级支持
   - 支持多轨/多场同时管理，独立议程与入场验证。
   - 支持座位分配、胸牌打印集成（CSV 导出/打印模板）。

5. 社交与网络化功能
   - 参与者可选择共享资料以建立网络（opt-in）。
   - 基于出席的信誉系统与跨活动档案。

6. 第三方集成
   - Sponsor 激活模块、赞助商分析访问接口
   - 集成第三方 event apps（API/webhook）

---

详细需求（用例驱动）

## Use Case 1: 组织者创建活动

主要参与者：组织者
前提条件：组织者已登录并通过钱包/zklogin 认证
基本流程：
1. 组织者点击“创建活动”。
2. 填写：标题、时间、地点、描述、封面图片、标签、容量、票种设置。
3. 上传富媒体到 Walrus（议程、演讲者等）。
4. 设置票务参数（价格、数量、可见性、是否审批）。
5. 提交并发布活动，系统在链上创建活动索引并在后端记录 walrus_blob_id

异常流程：
- 若 Walrus 上传失败，提示上传失败并回滚创建步骤。
- 若链上交易失败，标记为 pending 并且记录重试队列。

成功条件：活动创建并可被用户浏览/购买。

## Use Case 2: 用户购买门票

主要参与者：用户、支付网关
前提条件：用户已登录（钱包/ZkLogin）
基本流程：
1. 用户在活动页面选择票种并点击购买。
2. 前端请求后端生成订单/折扣校验（如有）并调用支付网关或引导钱包签名。
3. 支付成功后，触发链上铸票交易，Ticket NFT 铸造到用户钱包，walrus_blob_ref 写入 metadata。
4. 系统发送确认（UI 显示 + 可选邮件）并提供“添加到日历”链接。

异常流程：
- 支付失败：订单取消或标记失败。
- 铸票失败：记录失败并尝试重试或人工补救。

成功条件：用户收到 NFT，并可在客户端解密查看门票详情。

## Use Case 3: 入场验证与出席

主要参与者：门禁工作人员、用户
前提条件：用户持有门票 NFT
基本流程：
1. 工作人员在入口扫描用户提供的 QR 或读取钱包地址。
2. 系统验证 NFT 所有权与状态（是否已使用、是否被撤销）。
3. 验证通过：记录出席（attendance_records）并触发链上铸造 Attendance NFT（可选）。
4. 若需要打印胸牌/签到表，系统提供导出功能。

异常流程：
- 验证失败：提示无效门票或已失效。
- 离线模式：门禁设备本地缓存验证信息，稍后同步链上。

成功条件：用户被允许入场并生成出席证明。

---

非功能性需求

1. 可用性：系统需支持高并发售票，建议 99.9% 可用性。
2. 性能：主页与活动列表响应时间 < 300ms（缓存策略）。
3. 安全：私钥与敏感信息不在后端存储，使用 Seal 做端到端加密。
4. 隐私：遵守 GDPR 等合规要求，支持数据删除请求。
5. 本地化：支持中/英双语（后续扩展）。

---

API 概览（简要）

- `POST /api/v1/events` - 创建活动（organizer）
- `GET /api/v1/events` - 列表活动
- `GET /api/v1/events/:id` - 获取活动详情
- `POST /api/v1/events/:id/purchase` - 购买门票（创建订单）
- `POST /api/v1/payments/webhook` - 支付回调
- `POST /api/v1/tickets/:id/checkin` - 入场验证
- `GET /api/v1/users/:wallet/tickets` - 获取用户门票

---

验收标准

- MVP 功能（活动创建、购买、门票铸造、入场验证、出席 NFT）在 staging 环境可端到端运行。
- 安全审计通过基本检查项，密钥管理与加密策略满足要求。
- 文档齐全（部署、API、运维）。

---

下一步

1. 细化每个 API 的请求/响应与错误码。
2. 生成页面原型与 UX 流程图。
3. 基于此 PRD 生成迭代计划与里程碑。

维护者：Attenda 产品团队
