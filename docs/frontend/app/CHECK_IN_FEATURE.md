# æ‰«ç ç­¾åˆ°åŠŸèƒ½è¯´æ˜

## âœ… åŠŸèƒ½å·²å®Œæˆ

å·²æˆåŠŸå®ç°å®Œæ•´çš„æ‰«ç ç­¾åˆ°åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

### 1. **æœåŠ¡å±‚** (`checkin_service.dart`)
- âœ… åŠ è½½æ´»åŠ¨ä¿¡æ¯
- âœ… éªŒè¯ç¥¨æ®çŠ¶æ€
- âœ… æ‰§è¡Œé“¾ä¸Šç­¾åˆ°äº¤æ˜“
- âœ… æƒé™æ£€æŸ¥

### 2. **æ§åˆ¶å™¨** (`checkin_controller.dart`)
- âœ… çŠ¶æ€ç®¡ç†ï¼ˆåŠ è½½/å¤„ç†/æˆæƒçŠ¶æ€ï¼‰
- âœ… äºŒç»´ç è§£æ
- âœ… è‡ªåŠ¨æ‰§è¡Œç­¾åˆ°æµç¨‹
- âœ… é”™è¯¯å’ŒæˆåŠŸæ¶ˆæ¯ç®¡ç†

### 3. **ç•Œé¢** (`check_in_screen.dart`)
- âœ… æ‘„åƒå¤´æ‰«æ
- âœ… æ‰«ææ¡†å’Œè¦†ç›–å±‚
- âœ… æ´»åŠ¨ä¿¡æ¯å±•ç¤º
- âœ… å®æ—¶çŠ¶æ€åé¦ˆ
- âœ… æ‰‹ç”µç­’å’Œæ‘„åƒå¤´åˆ‡æ¢

## ğŸ“± ä½¿ç”¨æ–¹æ³•

### ä»æ´»åŠ¨åˆ—è¡¨è·³è½¬åˆ°æ‰«ç é¡µé¢

éœ€è¦ä¿®æ”¹ `event_card.dart`ï¼Œæ·»åŠ ä¸€ä¸ª"ç­¾åˆ°"æŒ‰é’®ï¼š

```dart
// åœ¨ EventCard widget ä¸­æ·»åŠ 
ElevatedButton.icon(
  onPressed: () {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => CheckInScreen(
          eventId: event.eventId, // ä¼ å…¥å®é™…çš„æ´»åŠ¨ID
        ),
      ),
    );
  },
  icon: const Icon(Icons.qr_code_scanner),
  label: const Text('æ‰«ç ç­¾åˆ°'),
  style: ElevatedButton.styleFrom(
    backgroundColor: Colors.orange,
  ),
)
```

### äºŒç»´ç æ•°æ®æ ¼å¼

ç¥¨æ®äºŒç»´ç åº”åŒ…å«ä»¥ä¸‹JSONæ ¼å¼æ•°æ®ï¼š

```json
{
  "ticketId": "0x...",
  "eventId": "0x...",
  "holder": "0x...",
  "verificationCode": "ABC123"
}
```

## ğŸ” æƒé™éªŒè¯

- âœ… åªæœ‰æ´»åŠ¨ç»„ç»‡è€…ï¼ˆorganizerï¼‰æ‰èƒ½æ‰«ç ç­¾åˆ°
- âœ… è‡ªåŠ¨éªŒè¯ç¥¨æ®çŠ¶æ€ï¼ˆactive/used/revokedï¼‰
- âœ… éªŒè¯ç¥¨æ®æ‰€å±æ´»åŠ¨

## ğŸ¯ ç­¾åˆ°æµç¨‹

1. **åˆå§‹åŒ–** â†’ åŠ è½½æ´»åŠ¨ä¿¡æ¯ï¼Œæ£€æŸ¥ç”¨æˆ·æƒé™
2. **æ‰«æ** â†’ æ‰“å¼€æ‘„åƒå¤´ï¼Œæ‰«æäºŒç»´ç 
3. **è§£æ** â†’ éªŒè¯JSONæ ¼å¼ï¼Œæ£€æŸ¥æ´»åŠ¨ID
4. **éªŒè¯** â†’ ä»é“¾ä¸Šè·å–ç¥¨æ®çŠ¶æ€
5. **æ‰§è¡Œ** â†’ è°ƒç”¨åˆçº¦ `attendance::record_attendance_with_verification`
6. **å®Œæˆ** â†’ æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼Œå¯ç»§ç»­æ‰«æ

## ğŸ“‹ åˆçº¦è°ƒç”¨

```dart
tx.moveCall(
  '$packageId::attendance::record_attendance_with_verification',
  arguments: [
    tx.object(eventId),                    // EventInfo (shared)
    tx.pure.address(ticketOwner),          // ç¥¨æ®æŒæœ‰è€…åœ°å€
    tx.object(ticketId),                   // Ticket (mutable)
    tx.pure(codeBytes),                    // éªŒè¯ç  (vector<u8>)
    tx.pure.u8(1),                         // éªŒè¯æ–¹å¼: 1 = QRæ‰«æ
    tx.object('0x6'),                      // Clock å¯¹è±¡
  ],
);
```

## ğŸš€ ä¸‹ä¸€æ­¥

1. âœ… ä¿®æ”¹ `event_list_screen.dart` æˆ– `event_card.dart`ï¼Œæ·»åŠ "ç­¾åˆ°"æŒ‰é’®
2. âœ… å°†å®é™…çš„ `eventId` ä¼ é€’ç»™ `CheckInScreen`
3. âœ… æµ‹è¯•å®Œæ•´æµç¨‹ï¼šåˆ›å»ºè´¦å· â†’ åŠ è½½æ´»åŠ¨ â†’ æ‰«ç ç­¾åˆ°

## âš ï¸ æ³¨æ„äº‹é¡¹

- ç¡®ä¿ç”¨æˆ·å·²åˆ›å»ºè´¦å·ï¼ˆ`AccountService`ï¼‰
- éœ€è¦è·å–æ´»åŠ¨ç»„ç»‡è€…æƒé™
- ç¥¨æ®å¿…é¡»æ˜¯ active çŠ¶æ€ï¼ˆstatus = 0ï¼‰
- æ¯å¼ ç¥¨åªèƒ½ç­¾åˆ°ä¸€æ¬¡

## ğŸ¨ ç•Œé¢ç‰¹æ€§

- ğŸŸ§ æ©™è‰²ä¸»é¢˜ï¼Œä¸åº”ç”¨é£æ ¼ä¸€è‡´
- ğŸ“· å®æ—¶æ‘„åƒå¤´é¢„è§ˆ
- ğŸ”¦ æ”¯æŒé—ªå…‰ç¯
- ğŸ”„ æ”¯æŒå‰åæ‘„åƒå¤´åˆ‡æ¢
- âœ… æ¸…æ™°çš„æˆåŠŸ/é”™è¯¯æç¤º
- ğŸ« æ´»åŠ¨ä¿¡æ¯å±•ç¤º
- ğŸ”’ æƒé™çŠ¶æ€æ˜¾ç¤º
